{% extends "base.html" %}

{% block title %}Student Dashboard - ACME University{% endblock %}

{% block content %}
<div class="header">
    <div class="welcome">Welcome {{ full_name }}!</div>
    <h1>ACME University</h1>
    <a href="{{ url_for('logout') }}" class="logout-link">Sign out</a>
</div>

<div class="content">
    <div class="tabs">
        <div class="tab active" onclick="showTab('your-courses')">Your Courses</div>
        <div class="tab" onclick="showTab('add-courses')">Add Courses</div>
    </div>

    <div id="your-courses" class="tab-content">
        <table>
            <thead>
                <tr>
                    <th>Course Name</th>
                    <th>Teacher</th>
                    <th>Time</th>
                    <th>Students Enrolled</th>
                </tr>
            </thead>
            <tbody>
                {% if my_courses %}
                    {% for course in my_courses %}
                    <tr>
                        <td>{{ course.course_name }}</td>
                        <td>{{ course.teacher }}</td>
                        <td>{{ course.time }}</td>
                        <td>{{ course.enrolled }}/{{ course.capacity }}</td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="4" style="text-align: center;">No courses enrolled yet</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <div id="add-courses" class="tab-content" style="display: none;">
        <table>
            <thead>
                <tr>
                    <th>Course Name</th>
                    <th>Teacher</th>
                    <th>Time</th>
                    <th>Students Enrolled</th>
                    <th>Add class</th>
                </tr>
            </thead>
            <tbody>
                {% for course in available_courses %}
                <tr>
                    <td>{{ course.course_name }}</td>
                    <td>{{ course.teacher }}</td>
                    <td>{{ course.time }}</td>
                    <td>{{ course.enrolled }}/{{ course.capacity }}</td>
                    <td style="text-align: center;">
                        {% if course.is_enrolled %}
                            <button class="btn btn-remove" onclick="unenroll({{ course.id }})">Remove</button>
                        {% elif course.is_full %}
                            <button class="btn btn-add" disabled>Full</button>
                        {% else %}
                            <button class="btn btn-add" onclick="enroll({{ course.id }})">Add</button>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function showTab(tabId) {
        //hide all tab contents
        const contents = document.querySelectorAll('.tab-content');
        contents.forEach(content => content.style.display = 'none');

        //remove active class from all tabs
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => tab.classList.remove('active'));

        //show selected tab content
        document.getElementById(tabId).style.display = 'block';

        //add active class to clicked tab
        event.target.classList.add('active');
    }

    function enroll(courseId) {
        fetch('/api/enroll', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ course_id: courseId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert(data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while enrolling');
        });
    }

    function unenroll(courseId) {
        if (confirm('Are you sure you want to drop this course?')) {
            fetch('/api/unenroll', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ course_id: courseId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert(data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while unenrolling');
            });
        }
    }
</script>
{% endblock %}